o:WebCache::Response:@content"(<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Jobly Documentation</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class=""><a href="index.html"><strong aria-hidden="true">1.</strong> What is Jobly</a></li><li class=""><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class=""><a href="usage/index.html"><strong aria-hidden="true">3.</strong> Usage</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="usage/quick-start/index.html"><strong aria-hidden="true">3.1.</strong> Quick Start</a></li><li class=""><a href="usage/server-side/index.html"><strong aria-hidden="true">3.2.</strong> Server Side</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="usage/server-side/server.html"><strong aria-hidden="true">3.2.1.</strong> Dashboard and API Server</a></li><li class=""><a href="usage/server-side/worker.html"><strong aria-hidden="true">3.2.2.</strong> Worker</a></li></ol></li><li class=""><a href="usage/client-side/index.html"><strong aria-hidden="true">3.3.</strong> Client Side</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="usage/client-side/running-jobs-with-the-cli.html"><strong aria-hidden="true">3.3.1.</strong> Running Jobs with the CLI</a></li><li class=""><a href="usage/client-side/running-jobs-with-the-api.html"><strong aria-hidden="true">3.3.2.</strong> Running Jobs with the API</a></li></ol></li></ol></li><li class=""><a href="building-jobs/index.html"><strong aria-hidden="true">4.</strong> Building Jobs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="building-jobs/scaffolding.html"><strong aria-hidden="true">4.1.</strong> Scaffolding</a></li><li class=""><a href="building-jobs/the-job-class.html"><strong aria-hidden="true">4.2.</strong> The Job Class</a></li><li class=""><a href="building-jobs/job-options.html"><strong aria-hidden="true">4.3.</strong> Job Options</a></li><li class=""><a href="building-jobs/callbacks.html"><strong aria-hidden="true">4.4.</strong> Job Callbacks</a></li><li class=""><a href="building-jobs/solo-jobs.html"><strong aria-hidden="true">4.5.</strong> Solo Jobs</a></li><li class=""><a href="building-jobs/storing-arbitrary-data-with-redis.html"><strong aria-hidden="true">4.6.</strong> Storing Arbitrary Data with Redis</a></li><li class=""><a href="building-jobs/loading-settings-from-yaml.html"><strong aria-hidden="true">4.7.</strong> Loading Settings from YAML</a></li><li class=""><a href="building-jobs/running-shell-commands.html"><strong aria-hidden="true">4.8.</strong> Running Shell Commands</a></li><li class=""><a href="building-jobs/loading-additional-code.html"><strong aria-hidden="true">4.9.</strong> Loading Additional Code</a></li></ol></li><li class=""><a href="logging-notifications-status/index.html"><strong aria-hidden="true">5.</strong> Logging, Notifications and Status</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="logging-notifications-status/logging.html"><strong aria-hidden="true">5.1.</strong> Logging</a></li><li class=""><a href="logging-notifications-status/reporting-job-progress.html"><strong aria-hidden="true">5.2.</strong> Reporting Job Progress</a></li><li class=""><a href="logging-notifications-status/sending-slack-notifications.html"><strong aria-hidden="true">5.3.</strong> Sending Slack Notifications</a></li></ol></li><li class=""><a href="configuration/index.html"><strong aria-hidden="true">6.</strong> Configuration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="configuration/jobly-config.html"><strong aria-hidden="true">6.1.</strong> Jobly Configuration</a></li><li class=""><a href="configuration/worker-config.html"><strong aria-hidden="true">6.2.</strong> Worker Configuration</a></li></ol></li><li class=""><a href="examples/index.html"><strong aria-hidden="true">7.</strong> Examples</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="examples/basic-example.html"><strong aria-hidden="true">7.1.</strong> Basic Example</a></li><li class=""><a href="examples/job-callbacks-example.html"><strong aria-hidden="true">7.2.</strong> Job Callbacks Example</a></li><li class=""><a href="examples/docker-compose-example.html"><strong aria-hidden="true">7.3.</strong> Docker Compose Example</a></li><li class=""><a href="examples/job-in-job-example.html"><strong aria-hidden="true">7.4.</strong> Job in Job Example</a></li><li class=""><a href="examples/namespaces-example.html"><strong aria-hidden="true">7.5.</strong> Namespaces Example</a></li><li class=""><a href="examples/options-and-errors-example.html"><strong aria-hidden="true">7.6.</strong> Options and Errors Example</a></li><li class=""><a href="examples/slack-notifications-example.html"><strong aria-hidden="true">7.7.</strong> Slack Notifications Example</a></li><li class=""><a href="examples/syslog-example.html"><strong aria-hidden="true">7.8.</strong> Syslog Example</a></li><li class=""><a href="examples/worker-config-example.html"><strong aria-hidden="true">7.9.</strong> Worker Config Example</a></li><li class=""><a href="examples/solo-example.html"><strong aria-hidden="true">7.10.</strong> Solo Job Example</a></li><li class=""><a href="examples/settings-example.html"><strong aria-hidden="true">7.11.</strong> Settings Example</a></li><li class=""><a href="examples/data-store-example.html"><strong aria-hidden="true">7.12.</strong> Data Store Example</a></li><li class=""><a href="examples/custom-rack-mount-example.html"><strong aria-hidden="true">7.13.</strong> Custom Rack Mount Example</a></li><li class=""><a href="examples/basic-auth-example.html"><strong aria-hidden="true">7.14.</strong> Basic Auth Example</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Jobly Documentation</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                            <a href="https://github.com/dannyben/jobly" title="Git repository" aria-label="Git repository">
                                <i id="git-repository-button" class="fa fa-github"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div style='text-align: center'>
<p><a href='/'><img src='/assets/logo.svg' style='max-width: 400px'></a>
<br>
Compact job server with API, CLI, Web UI and a Sidekiq heart.</p>
</div>
<hr />
<h1><a class="header" href="#welcome-to-the-jobly-documentation" id="welcome-to-the-jobly-documentation">Welcome to the Jobly Documentation</a></h1>
<p>Jobly is a sidekiq-based job server with a command line interface, web API
and a web dashboard.</p>
<h2><a class="header" href="#whats-in-the-box" id="whats-in-the-box">What's in the Box</a></h2>
<ul>
<li><strong>Command line interface</strong> - for starting the server, starting the worker,
and for running jobs.</li>
<li><strong>Web API</strong> - for executing jobs.</li>
<li><strong>Web Dashboard</strong> - including job progress and status.</li>
<li><strong>Remote Syslog Support</strong> - send output to Papertrail or remote syslog.</li>
<li><strong>Slack Notifications</strong> - report job progress to Slack.</li>
</ul>
<h2><a class="header" href="#screencast" id="screencast">Screencast</a></h2>
<p><object data="/assets/cast.svg" style='width:100%'></object></p>
<h2><a class="header" href="#screenshot" id="screenshot">Screenshot</a></h2>
<p><img src="/assets/screen.gif" alt="" /></p>
<h2><a class="header" href="#interactive-demo" id="interactive-demo">Interactive Demo</a></h2>
<p>For an interactive demo, visit the
<a href="https://www.katacoda.com/dannyb/scenarios/jobly">Jobly scenario on Katacoda</a>.</p>
<h2><a class="header" href="#keyboard-shortcuts-for-this-documentation-site" id="keyboard-shortcuts-for-this-documentation-site">Keyboard Shortcuts for this Documentation Site</a></h2>
<table><thead><tr><th>Shortcut</th><th>Action</th></tr></thead><tbody>
<tr><td><strong>s</strong></td><td>Focus the search field</td></tr>
<tr><td><strong>Up</strong> / <strong>Down</strong></td><td>Navigate in search results</td></tr>
<tr><td><strong>Right</strong> / <strong>Left</strong></td><td>Navigate to next / previous page</td></tr>
</tbody></table>
<h1><a class="header" href="#installation" id="installation">Installation</a></h1>
<p>Jobly is packaged as a Ruby gem, install it by running:</p>
<pre><code class="language-text">$ gem install jobly
</code></pre>
<p>Alternatively, you can download the the official
<a href="https://github.com/dannyben/docker-jobly">Jobly docker image</a>.</p>
<h2><a class="header" href="#prerequisites" id="prerequisites">Prerequisites</a></h2>
<ul>
<li>Ruby 2.5 or higher</li>
<li>Redis server</li>
</ul>
<h1><a class="header" href="#usage" id="usage">Usage</a></h1>
<ul>
<li><a href="usage/quick-start">Quick Start</a></li>
<li><a href="usage/server-side">Server Side</a></li>
<li><a href="usage/client-side">Client Side</a></li>
</ul>
<h1><a class="header" href="#quick-start" id="quick-start">Quick Start</a></h1>
<p>These steps are similar (but not identical) to the steps demonstrated in
the <a href="usage/quick-start//#screencast">What is Jobly screencast</a>.</p>
<h2><a class="header" href="#step-1-setup-a-jobly-workspace" id="step-1-setup-a-jobly-workspace">Step 1: Setup a Jobly workspace</a></h2>
<pre><code class="language-bash"># Create a new workspace (directory)
$ jobly init myjobs

# Make sure dependencies are installed
$ cd myjobs
$ bundle install

# Start the web server and the worker
$ foreman start

# Alternative:
# You may also start the server and worker manually in two separate screens
$ jobly server
$ jobly worker
</code></pre>
<h2><a class="header" href="#step-2-verify-the-server-is-working" id="step-2-verify-the-server-is-working">Step 2: Verify the server is working</a></h2>
<p>Go to <a href="http://localhost:3000">http://localhost:3000</a> - you should see the Sidekiq dashboard</p>
<h2><a class="header" href="#step-3-execute-a-job-through-the-api" id="step-3-execute-a-job-through-the-api">Step 3: Execute a job through the API</a></h2>
<p>Go to <a href="http://localhost:3000/do/Hello">http://localhost:3000/do/Hello</a> - you should receive a JSON encoded 
acknowledgement.</p>
<p>Go back to the dashboard and view the job's status.</p>
<h2><a class="header" href="#step-4-execute-a-job-through-the-cli" id="step-4-execute-a-job-through-the-cli">Step 4: Execute a job through the CLI</a></h2>
<p>Form the same workspace directory, run:</p>
<pre><code class="language-bash"># Execute the job directly (without the server)
$ jobly run Ping

# Send the job through the Web API server
$ jobly send Ping

# Send the job through the Web API server, with parameters
$ jobly send Hello name:Arnold
</code></pre>
<p>Finally, view the <a href="http://localhost:3000/statuses">http://localhost:3000/statuses</a> page to ensure your jobs
were executed.</p>
<h1><a class="header" href="#server-side" id="server-side">Server Side</a></h1>
<ul>
<li><a href="usage/server-side/server.html">Dashboard and API Server</a></li>
<li><a href="usage/server-side/worker.html">Worker</a></li>
</ul>
<h1><a class="header" href="#dashboard-and-api-server" id="dashboard-and-api-server">Dashboard and API Server</a></h1>
<p>To start the web server:</p>
<ol>
<li>Run <code>jobly server</code> from the command line.</li>
<li>Open <a href="http://localhost:3000">http://localhost:3000</a> in your browser.</li>
</ol>
<p>This will start a server with two primary entry points: Web Dashboard and
Jobly API.</p>
<h3><a class="header" href="#web-dashboard" id="web-dashboard">Web Dashboard</a></h3>
<p>This dashboard is available at the root of the web server. It is a sidekiq
web dashboard, with additional plugins for job progress and status.</p>
<h3><a class="header" href="#the-jobly-api-server" id="the-jobly-api-server">The Jobly API Server</a></h3>
<p>This is a simple web API server that allows you to execute jobs remotely by
calling <code>/do/JobName?param=value</code>.</p>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>:
<a href="usage/server-side//usage/client-side/running-jobs-with-the-api.html">Running Jobs with the API</a></p>
</blockquote>
<h1><a class="header" href="#worker" id="worker">Worker</a></h1>
<p>To start processing jobs:</p>
<ol>
<li>Run <code>jobly worker</code>.</li>
<li>That's it.</li>
</ol>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>:
<a href="usage/server-side//configuration/worker-config.html">Worker Configuration</a></p>
</blockquote>
<h1><a class="header" href="#client-side" id="client-side">Client Side</a></h1>
<ul>
<li><a href="usage/client-side/running-jobs-with-the-cli.html">Running jobs with the CLI</a></li>
<li><a href="usage/client-side/running-jobs-with-the-api.html">Running jobs with the API</a></li>
</ul>
<h1><a class="header" href="#running-jobs-with-the-cli" id="running-jobs-with-the-cli">Running Jobs with the CLI</a></h1>
<p>There are three ways to run a job from the command line:</p>
<p>Run the job locally, without going through any of the background job
processing chain:</p>
<pre><code class="language-bash">$ jobly run JobName param:value
</code></pre>
<p>Run the job locally, but wait for a worker to process it.</p>
<pre><code class="language-bash">$ jobly run --later JobName param:value
</code></pre>
<p>Send a job through the API (either localhost or remote).</p>
<pre><code class="language-bash">$ jobly send JobName param:value
</code></pre>
<h1><a class="header" href="#running-jobs-with-the-api" id="running-jobs-with-the-api">Running Jobs with the API</a></h1>
<p>The API supports running jobs either by GET or by POST in the following URL
structure:</p>
<pre><code class="language-text">http://localhost:3000/do/JobName
</code></pre>
<h2><a class="header" href="#example" id="example">Example</a></h2>
<pre><code class="language-text">$ curl localhost:3000/do/Build
</code></pre>
<p>Or, if your job requires parameters, provide them through the query string:</p>
<pre><code class="language-text">$ curl localhost:3000/do/Build?deploy=no
</code></pre>
<h2><a class="header" href="#response" id="response">Response</a></h2>
<h3><a class="header" href="#on-success-200-ok" id="on-success-200-ok">On success (<strong>200 OK</strong>)</a></h3>
<pre><code class="language-json">{
  &quot;status&quot;: &quot;received&quot;,
  &quot;job&quot;: &quot;Build&quot;,
  &quot;params&quot;: {
    &quot;deploy&quot;:&quot;no&quot;
  }
}
</code></pre>
<h3><a class="header" href="#on-failure-404-not-found" id="on-failure-404-not-found">On failure (<strong>404 Not Found</strong>)</a></h3>
<pre><code class="language-json">{
  &quot;status&quot;: &quot;error&quot;,
  &quot;message&quot;: &quot;No such job&quot;,
  &quot;job&quot;: &quot;BuildAndRun&quot;,
  &quot;params&quot;: {}
}
</code></pre>
<h1><a class="header" href="#building-jobs" id="building-jobs">Building Jobs</a></h1>
<p>In order to build a <strong>jobs workspace</strong>, start in an empty folder and create
a <code>./jobs</code> sub folder inside it. All your job classes go in this folder.
The name of this folder is configurable.</p>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>: <a href="building-jobs//configuration">Configuration</a></p>
</blockquote>
<p>All the Ruby files in the <code>./jobs</code> folder will be loaded by all of Jobly's
commands. It is recommended to only keep Job classes in this folder.
If you need to load additional code, you can use the <code>./app</code> folder.</p>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>:
<a href="building-jobs/loading-additional-code.html">Loading Additional Code</a></p>
</blockquote>
<p>Your job classes should simply inherit from <code>Jobly::Job</code>, like this:</p>
<pre><code class="language-ruby">class Hello &lt; Jobly::Job
  def execute
    # Your code here
  end
end
</code></pre>
<h1><a class="header" href="#scaffolding" id="scaffolding">Scaffolding</a></h1>
<p>Jobly comes with a simple scaffolding command to get you started quickly
with a proper directory structure for a jobs workspace.</p>
<p>Run:</p>
<pre><code class="language-bash">$ jobly init myjobs
</code></pre>
<p>in order to create a jobs workspace inside the <code>myjobs</code> directory, or:</p>
<pre><code class="language-bash">$ jobly init --help
</code></pre>
<p>for additional options.</p>
<h1><a class="header" href="#the-job-class" id="the-job-class">The Job Class</a></h1>
<p>A job class is a simple Ruby class inheriting from <code>Jobly::Job</code>.</p>
<p>The only requirement is that your class implements an <code>execute</code> method that
optionally accepts keyword arguments (recommended), or a hash.</p>
<p>Example:</p>
<pre><code class="language-ruby">class Hello &lt; Jobly::Job
  def execute(name: 'bob')
    puts &quot;Hello #{name}&quot;
    logger.info &quot;said hello to #{name}&quot;
  end
end
</code></pre>
<p>Note that these classes are simply Jobly-flavored sidekiq jobs, with these
key differences:</p>
<ul>
<li>
<p>You need to implement <code>execute</code> instead of <code>perform</code></p>
</li>
<li>
<p>Job arguments are defined as keyword arguments, instead of positional </p>
<p>arguments.</p>
</li>
</ul>
<h1><a class="header" href="#job-options" id="job-options">Job Options</a></h1>
<p>The <code>Jobly::Job</code> class supports these class-level options:</p>
<table><thead><tr><th align="left">Key</th><th align="left">Default</th><th align="left">Purpose</th></tr></thead><tbody>
<tr><td align="left"><code>queue</code></td><td align="left"><code>default</code></td><td align="left">set the name of the queue for this job.</td></tr>
<tr><td align="left"><code>retries</code></td><td align="left"><code>5</code></td><td align="left">number of times to retry on failure.</td></tr>
<tr><td align="left"><code>backtrace</code></td><td align="left"><code>5</code></td><td align="left">number of backtrace lines to show in case of failures. Can be <code>true</code>, <code>false</code> or a number of lines to save.</td></tr>
<tr><td align="left"><code>solo</code></td><td align="left"><code>false</code></td><td align="left">Specify that this task should only be executed once. If the same job is executed while this job is running, it will be skipped. See <a href="building-jobs/solo-jobs.html">Solo Jobs</a> for more information.</td></tr>
</tbody></table>
<p>For example:</p>
<pre><code class="language-ruby">class Deploy &lt; Jobly::Job
  solo
  queue 'critical'
  backtrace 10
  retries 3

  def execute
    puts &quot;Deploying&quot;
  end
end
</code></pre>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>: <a href="building-jobs/solo-jobs.html">Solo Jobs</a></p>
</blockquote>
<h1><a class="header" href="#job-callbacks" id="job-callbacks">Job Callbacks</a></h1>
<p>The <code>Jobly::Job</code> class supports these callback methods:</p>
<table><thead><tr><th align="left">Method</th><th align="left">Description</th></tr></thead><tbody>
<tr><td align="left"><code>before</code></td><td align="left">Executes before the job starts</td></tr>
<tr><td align="left"><code>on_skip</code></td><td align="left">Executes if <code>skip_job</code> was called from the <code>before</code> block</td></tr>
<tr><td align="left"><code>on_success</code></td><td align="left">Executes after the job finishes, and only if it succeeds</td></tr>
<tr><td align="left"><code>on_failure</code></td><td align="left">Executes after the job finishes, and only if it fails</td></tr>
<tr><td align="left"><code>after</code></td><td align="left">Executes after the job finishes, regardless of success or failure</td></tr>
</tbody></table>
<p>Each callback method can either be a block or a symbol that points to a local
method. When using a block, you will have the <code>params</code> variable available,
with all the parameteres sent to the job.</p>
<p>For example:</p>
<pre><code class="language-ruby">class Greet &lt; Jobly::Job
  before do
    logger.info &quot;Starting with #{params[:message]}&quot;
  end

  after :reboot_computer

  def execute(message: &quot;Hello&quot;)
    puts message
  end

  def reboot_computer
    system &quot;reboot&quot;
  end
end
</code></pre>
<p>In order to conditionally skip a job from its <code>before</code> block, you can call
<code>skip_job</code>. This will avoid running the job, and will execute the <code>on_skip</code>
action and the <code>after</code> action, if present.</p>
<h1><a class="header" href="#solo-jobs" id="solo-jobs">Solo Jobs</a></h1>
<p>Jobs can be defined so that they only have one instance running at any given
time, by using the <code>solo</code> method.</p>
<pre><code class="language-ruby">class Test &lt; Jobly::Job
  solo

  def execute
    # Job code here
  end
end
</code></pre>
<p>Solo Jobs (also known as Unique Jobs) will register a lock key in redis
before execution, which will prevent subsequent jobs with the same
fingerprint from running until the lock is released. The lock will be
automatically removed when the job completes (even if it fails), or after a
one hour expiration period.</p>
<p>When a job is skipped due to locking, it will execute the <code>on_skip</code> callback.</p>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>: <a href="building-jobs/callbacks.html">Job Callbacks</a></p>
</blockquote>
<h2><a class="header" href="#job-fingerprint" id="job-fingerprint">Job Fingerprint</a></h2>
<p>By default, the job's fingerprint is built of its class name and its
parameters. You can specify a different fingerprint in one of two ways:</p>
<h3><a class="header" href="#option-1---use-the-key-property" id="option-1---use-the-key-property">Option 1 - Use the 'key' property:</a></h3>
<pre><code class="language-ruby">class Test &lt; Jobly::Job
  solo key: 'my-test-job'

  def execute
    # Job code here
  end
end
</code></pre>
<h3><a class="header" href="#option-2-define-a-solo_key-method-in-your-job" id="option-2-define-a-solo_key-method-in-your-job">Option 2: Define a 'solo_key' method in your job:</a></h3>
<pre><code class="language-ruby">class Test &lt; Jobly::Job
  solo

  def execute(region: 'eu')
    # Job code here
  end

  def solo_key
    &quot;Test:#{params[:region]}&quot;
  end
end
</code></pre>
<blockquote>
<p><i class='fa fa-info-circle'></i> <strong>Tip</strong>: The <code>#solo_key</code> method can use
any of the job's parameters by accessing the <code>params</code> hash.</p>
</blockquote>
<h2><a class="header" href="#lock-expiration-safeguard" id="lock-expiration-safeguard">Lock Expiration Safeguard</a></h2>
<p>By default, the locks are set to expire after one hour. This is designed as a
safeguard to avoid dead locks. Under most circumstances, you do not need to
worry about it, since locks are automatically released on job completion, but
in case you wish to change the default expiration period, you can use the
<code>expire</code> option:</p>
<pre><code class="language-ruby">class Test &lt; Jobly::Job
  solo expire: 30.minutes

  def execute(region: 'eu')
    # Job code here
  end

  def solo_key
    &quot;Test:#{param[:region]}&quot;
  end
end
</code></pre>
<p>You can use <code>seconds</code>, <code>minutes</code>, <code>hours</code> and <code>days</code>.</p>
<blockquote>
<p><i class='fa fa-exclamation-triangle'></i> <strong>Note</strong>: Expiration timer
starts to count down from the moment the job is queued, and <em>not</em> from the
moment it is executed.</p>
</blockquote>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>: <a href="building-jobs//examples/solo-example.html">Solo Job Example</a></p>
</blockquote>
<h1><a class="header" href="#storing-arbitrary-data-with-redis" id="storing-arbitrary-data-with-redis">Storing Arbitrary Data with Redis</a></h1>
<p>Jobly comes bundled with
<a href="https://github.com/utgarda/sidekiq-status">Sidekiq::Status</a>
which has a built in ability allowing you to store and use arbitrary data in
its Redis database.</p>
<pre><code class="language-ruby"># jobs/hello.rb
class Hello &lt; Jobly::Job
  def execute(name: 'bob')
    # Store arbitrary data
    store vino: 'veritas'

    # Retrieve data.
    vino = retrieve :vino
  end
end
</code></pre>
<p>Note that:</p>
<ol>
<li>Values are always stored as a String, so you will need to convert them
to other types when appropriate.</li>
<li>When <code>retrieve</code> does not find the key, <code>nil</code> is returned.</li>
<li>Stored keys are available across jobs.</li>
</ol>
<h1><a class="header" href="#loading-settings-from-yanl" id="loading-settings-from-yanl">Loading Settings from YANL</a></h1>
<p>Jobly comes bundled with <a href="https://github.com/dannyben/sting">Sting</a>, which provides you with a <code>settings</code>
helper which lets you use custom YAML files for configuring your jobs.</p>
<h2><a class="header" href="#settings-files" id="settings-files">Settings files</a></h2>
<ol>
<li>Place <code>settings.yml</code> in the <code>config</code> folder.</li>
<li>Optionally, place additional <code>settings.&lt;encuronment&gt;.yml</code> (for example
<code>settings.production.yml</code>) files for each of your environments. These
files will be loaded based on the <code>JOBLY_ENVIRONMENT</code> configuration.</li>
</ol>
<h2><a class="header" href="#erb" id="erb">ERB</a></h2>
<p>Before the YAML files are loaded, they are evaluated with ERB, so you can
use Ruby code in them (for example, to load environment variables):</p>
<pre><code class="language-yaml"># config/settings.yml
host: localhost
port: &lt;%= ENV['PORT'] || 3000 %&gt;
</code></pre>
<h2><a class="header" href="#using-settings-in-your-jobs" id="using-settings-in-your-jobs">Using settings in your jobs</a></h2>
<p>Your jobs will have access to a <code>settings</code> object:</p>
<pre><code class="language-ruby"># jobs/push.rb
class Push &lt; Jobly::Job
  def execute
    puts settings.host
  end
end
</code></pre>
<h2><a class="header" href="#using-settings-in-other-classes" id="using-settings-in-other-classes">Using settings in other classes</a></h2>
<p>To have the <code>settings</code> object available to other (non <code>Jobly::Job</code>) classes,
include the <code>Jobly::Settings</code> module (or the more inclusive <code>Jobly::Helpers</code>
module).</p>
<pre><code class="language-ruby"># app/docker.rb
class Docker
  include Jobly::Settings
  
  def pull
    puts settings.docker_registry
  end
end
</code></pre>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>:
<a href="building-jobs//examples/settings-example.html">Settings Example</a></p>
</blockquote>
<h1><a class="header" href="#running-shell-commands" id="running-shell-commands">Running Shell Commands</a></h1>
<p>Although you can use any Ruby method to execute shell and system commands
from within your jobs, Jobly comes bundled with
<a href="https://github.com/piotrmurach/tty-command">TTY::Command</a>
which is made available to your jobs by using the <code>#shell</code> method.</p>
<pre><code class="language-ruby"># jobs/shell.rb
class Shell &lt; Jobly::Job
  def execute
    shell.run &quot;docker pull ubuntu&quot;
  end
end
</code></pre>
<p>Using this method is recommended, since it automatically sends the STDOUT
and STDERR of the command to the configured logging device, and it will raise
an exception on failure, which will fail the job.</p>
<h2><a class="header" href="#accessing-the-shell-helper-from-other-classes" id="accessing-the-shell-helper-from-other-classes">Accessing the shell helper from other classes</a></h2>
<p>To include the <code>shell</code> helper in other classes (non <code>Jobly::Job</code>), you can
include the <code>Jobly::Shell</code> module (or the more inclusive <code>Jobly::Helpers</code>
module).</p>
<pre><code class="language-ruby"># app/git.rb
class Git
  include Jobly::Shell

  def clone(repo)
    shell.exec &quot;git clone #{repo}&quot;
  end
end
</code></pre>
<h1><a class="header" href="#loading-additional-code" id="loading-additional-code">Loading Additional Code</a></h1>
<p>In case your jobs require additional functionality, you may create the
<code>./app</code> folder as a sibling to the <code>./jobs</code> folder (configurable).</p>
<p>All ruby files in this folder (and sub folders) will be automatically
loaded and available to your jobs.</p>
<h2><a class="header" href="#access-job-helpers-from-custom-code" id="access-job-helpers-from-custom-code">Access job helpers from custom code</a></h2>
<p>Custom code that does not inherit from <code>Jobly::Job</code> will not be able to
access some job features, such as logging and slack notifications.</p>
<p>To enable such access, you can <code>include Jobly::Helpers</code> in your custom code:</p>
<pre><code class="language-ruby"># app/git.rb
class Git
  include Jobly::Helpers

  def pull(repo)
    logger.info &quot;pulling #{repo}...&quot;
  end
end
</code></pre>
<p>The <code>Jobly::Helpers</code> module is a shortcut that includes several helpers. You
can include them separately if you prefer:</p>
<pre><code class="language-ruby">include Jobly::Logging
include Jobly::Slack
include Jobly::Shell
include Jobly::Settings
</code></pre>
<h1><a class="header" href="#logging-notifications-and-status" id="logging-notifications-and-status">Logging, Notifications and Status</a></h1>
<ul>
<li><a href="logging-notifications-status/logging.html">Logging</a></li>
<li><a href="logging-notifications-status/reporting-job-progress.html">Reporting Job Progress</a></li>
<li><a href="logging-notifications-status/sending-slack-notifications.html">Sending Slack Notifications</a></li>
</ul>
<h1><a class="header" href="#logging" id="logging">Logging</a></h1>
<h3><a class="header" href="#logging-from-within-jobs" id="logging-from-within-jobs">Logging from within jobs</a></h3>
<p>All your jobs have access to a standard Ruby logger.</p>
<pre><code class="language-ruby"># jobs/hello.rb
class Hello &lt; Jobly::Job
  def execute(name: 'bob')
    logger.info &quot;said hello to #{name}&quot;
  end
end
</code></pre>
<h3><a class="header" href="#logging-from-other-classes" id="logging-from-other-classes">Logging from other classes</a></h3>
<p>In case you need access to the logger from other classes (that do not
inherit from <code>Jobly::Job</code>), you can include the <code>Jobly::Logging</code> module
(or the more inclusive <code>Jobly::Helpers</code> module).</p>
<pre><code class="language-ruby"># app/git.rb
class Git
  include Jobly::Logging

  def pull(repo)
    logger.info &quot;pulling #{repo}...&quot;
  end
end
</code></pre>
<h3><a class="header" href="#configuring-the-logger" id="configuring-the-logger">Configuring the logger</a></h3>
<p>By default, output is sent to <code>STDOUT</code> but you can provide your own logger
and log to a file or to syslog by using the <code>config.log</code> or the
<code>config.logger</code> option in <code>./config/jobly.rb</code></p>
<pre><code class="language-ruby"># config/jobly.rb
Jobly.configure do |config|
  config.log = '/var/log/jobly.log'
  
  # same as:
  # config.log = Logger.new '/var/log/jobly.log'

  config.logger.level = Logger::WARN
end
</code></pre>
<p>The <code>config.log</code> option controls how logging is handled.</p>
<ol>
<li>If left empty (<code>nil</code>), the web server and workers will NOT log anywhere,
and your jobs will log to <code>STDOUT</code> whenever you use <code>logger</code>.</li>
<li>Setting it to <code>config.log = 'stdout'</code> will also instruct the web server
and worker to send their logging to <code>STDOUT</code>.</li>
<li>Setting it to a filename, will log to a file.</li>
<li>Setting it to a syslog connection string will log to a remote syslog server. </li>
</ol>
<h3><a class="header" href="#logging-to-syslog" id="logging-to-syslog">Logging to syslog</a></h3>
<p>Set <code>config.log</code> to a syslog connection string in the following format:</p>
<p><code>syslog://system:program@host:port</code></p>
<p>Omitting any of the options will fall back to a sensible default.</p>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>:
<a href="logging-notifications-status//examples/syslog-example.html">Syslog Example</a></p>
</blockquote>
<h3><a class="header" href="#separate-log-files-for-each-job-class" id="separate-log-files-for-each-job-class">Separate log files for each job class</a></h3>
<p>If  <code>Jobly.log</code> contains <code>%s</code> in the file path, it will be replaced with the
slug of the job, and will create separate log files for each job class.</p>
<pre><code class="language-ruby"># config/jobly.rb
Jobly.configure do |config|
  config.log = 'logs/%s.log'
end
</code></pre>
<h3><a class="header" href="#automatic-syslog-tagging" id="automatic-syslog-tagging">Automatic syslog tagging</a></h3>
<p>The same <code>%s</code> replacement principle applies when using a syslog connection
string. This is intended to allow tagging of syslog messages with the job
name.</p>
<pre><code class="language-ruby"># config/jobly.rb
Jobly.configure do |config|
  config.log = 'syslog://jobserver:%s@localhost:514'
end
</code></pre>
<h3><a class="header" href="#bring-your-own-logger" id="bring-your-own-logger">Bring your own logger</a></h3>
<p>The <code>config.log</code> option can also accept any <code>Logger</code> instance, in case you
wish to provide a custom logger.</p>
<h1><a class="header" href="#reporting-job-progress" id="reporting-job-progress">Reporting Job Progress</a></h1>
<p>Jobly comes bundled with
<a href="https://github.com/utgarda/sidekiq-status">Sidekiq::Status</a>
which provides you with a live status dashboard, and a way to report
progress in your jobs.</p>
<p><img src="logging-notifications-status//assets/screen.gif" alt="" /></p>
<p>In order to report progress from your job, use the <code>total</code> and <code>at</code> methods.
In addition, you can store arbitrary data related to your job with <code>store</code>
and <code>retrieve</code>.</p>
<pre><code class="language-ruby"># jobs/hello.rb
class Hello &lt; Jobly::Job
  def execute(name: 'bob')
    # How many steps this job has (default is 100)
    total 100 

    # 5/100 = 5% completion
    at 5, &quot;Initializing&quot;
  end
end
</code></pre>
<h1><a class="header" href="#sending-slack-notifications" id="sending-slack-notifications">Sending Slack Notifications</a></h1>
<p>Jobly comes bundled with
<a href="https://github.com/stevenosloan/slack-notifier">Slack::Notifier</a>
which is made available to your jobs using the <code>#slack</code> method.</p>
<pre><code class="language-ruby"># jobs/greet.job
class Greet &lt; Job
  # Optional settings (defaults to #debug and Jobly)
  # Can also be set in the configuration
  slack_channel '#debug'
  slack_user 'Greeter'

  def execute(name: 'bob')
    # Quick message
    slack.ping &quot;Hello #{name}&quot;

    # Message with attachment
    slack.post attachments: { text: &quot;Good text&quot;, color: &quot;good&quot; }
  end
end
</code></pre>
<h2><a class="header" href="#sending-notifications-from-other-classes" id="sending-notifications-from-other-classes">Sending notifications from other classes</a></h2>
<p>To include the <code>slack</code> helper in other classes (non <code>Jobly::Job</code>), you can
include the <code>Jobly::Slack</code> module (or the more inclusive <code>Jobly::Helpers</code>
module).</p>
<pre><code class="language-ruby"># app/git.rb
class Git
  include Jobly::Slack

  def pull(repo)
    slack.ping &quot;pulling #{repo}&quot;
  end
end
</code></pre>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>:
<a href="logging-notifications-status//examples/slack-notifications-example.html">Slack Notifications Example</a></p>
</blockquote>
<h1><a class="header" href="#configuration" id="configuration">Configuration</a></h1>
<ul>
<li><a href="configuration/jobly-config.html">Jobly Configuration</a></li>
<li><a href="configuration/worker-config.html">Worker Configuration</a></li>
<li><a href="configuration/logging.html">Logging</a></li>
</ul>
<h1><a class="header" href="#jobly-configuraion" id="jobly-configuraion">Jobly Configuraion</a></h1>
<p>Configuring Jobly can be done by one of two methods:</p>
<ol>
<li>Setting environment variables.</li>
<li>Adding a <code>config/jobly.rb</code> to your jobs workspace.</li>
</ol>
<h3><a class="header" href="#environment-variable-reference" id="environment-variable-reference">Environment Variable Reference</a></h3>
<table><thead><tr><th align="left">Environment Variable</th><th align="left">Default</th></tr></thead><tbody>
<tr><td align="left"><code>JOBLY_ENVIRONMENT</code></td><td align="left"><code>development</code></td></tr>
<tr><td align="left"><code>JOBLY_API_URL</code></td><td align="left"><code>http://localhost:3000/do</code></td></tr>
<tr><td align="left"><code>JOBLY_APP_PATH</code></td><td align="left"><code>app</code></td></tr>
<tr><td align="left"><code>JOBLY_CONFIG_PATH</code></td><td align="left"><code>config</code></td></tr>
<tr><td align="left"><code>JOBLY_REDIS_URL</code></td><td align="left"><code>redis://localhost:6379/0</code></td></tr>
<tr><td align="left"><code>JOBLY_STATUS_EXPIRATION</code></td><td align="left"><code>30</code></td></tr>
<tr><td align="left"><code>JOBLY_JOBS_NAMESPACE</code></td><td align="left">unset</td></tr>
<tr><td align="left"><code>JOBLY_LOG</code></td><td align="left">unset</td></tr>
<tr><td align="left"><code>JOBLY_SLACK_WEBHOOK</code></td><td align="left">unset</td></tr>
<tr><td align="left"><code>JOBLY_SLACK_CHANNEL</code></td><td align="left"><code>#general</code></td></tr>
<tr><td align="left"><code>JOBLY_SLACK_USER</code></td><td align="left"><code>Jobly</code></td></tr>
<tr><td align="left"><code>JOBLY_AUTH</code></td><td align="left">unset</td></tr>
</tbody></table>
<h2><a class="header" href="#jobly-configuration-file" id="jobly-configuration-file">Jobly Configuration File</a></h2>
<pre><code class="language-ruby"># config/jobly.rb
Jobly.configure do |config|
  # Full configuration file. Everything is optional and has defaults.
  # This file is loaded on boot by the server, worker and jobly CLI.
  # ---

  # environment: development | production
  # Sets the environment for the API Sinatra server and for Sidekiq.
  # Default: ENV['JOBLY_ENVIRONMENT'] || 'development'
  config.environment = 'production'

  # api_url: url
  # Sets the URL to the API server.
  # Default: ENV['JOBLY_API_URL'] || 'http://localhost:3000/do'
  config.api_url = 'http://localhost:3000/do'

  # app_path: relative or absolute path
  # Sets the path to the optional folder that may contain support files for
  # the jobs. All ruby files in this folder are loaded first.
  # Default: ENV['JOBLY_APP_PATH'] || 'app'
  config.app_path = 'app'

  # jobs_path: relative or absolute path
  # Sets the path to the jobs folder. All ruby files in this folder are loaded
  # automatically by all of Jobly's components.
  # Default: ENV['JOBLY_JOBS_PATH'] || 'jobs'
  config.jobs_path = 'jobs'

  # config_path: relative or absolute path
  # Sets the path to the config directory. This is where Jobly looks for this
  # jobly.rb configuration file, so it should be set via the environment
  # variable if you wish to change it.
  # Default: ENV['JOBLY_CONFIG_PATH'] || 'config'
  config.config_path = 'config'

  # redis_url: url
  # Sets the full URL to the redis database
  # Default: ENV['JOBLY_REDIS_URL'] || 'redis://localhost:6379/0'
  config.redis_url = 'redis://localhost:6379/0'

  # status_expiration: minutes
  # Sets the number of minutes that completed jobs are kept in the Statuses
  # tab.
  # Default: ENV['JOBLY_STATUS_EXPIRATION'] || 30
  config.status_expiration = 5

  # jobs_namespace: string
  # Sets the namespace (module name) that your jobs are defined in. For 
  # example, if your Job classes are in fact defined as `MyJobs::SomeJob` 
  # then this option should be set to `MyJobs`.
  # Default: ENV['JOBLY_JOBS_NAMESPACE'] || nil
  config.jobs_namespace = nil

  # log: string or logger instance
  # Sets the logger that will be used by the servers and worker. This logger
  # is also available to your jobs with the `logger` method.
  # This can be one of these strings:
  # - stdout
  # - syslog://system:program@host:port
  # - filename
  # Or your own Logger instance.
  # Default: ENV['JOBLY_LOG'] || nil (log to STDOUT)
  config.log = 'jobly.log'

  # slack_webhook: url
  # To use the built in slack notifier, set this slack
  # webhook.
  # Default: ENV['JOBLY_SLACK_WEBHOOK']
  config.slack_webhook = &quot;https://hooks.slack.com/...&quot;
  
  # slack_channel: string
  # Sets the default slack channel.
  # This can be overwritten on a per-job basis.
  # Default: ENV['JOBLY_SLACK_CHANNEL'] || '#general'
  config.slack_channel = '#debug'
  
  # slack_user: string
  # Sets the default slack user name to display.
  # This can be overwritten on a per-job basis.
  # Default: ENV['JOBLY_SLACK_USER'] || 'Jobly'
  config.slack_user = 'Botly'
  
  # mounts: hash
  # Mount additional rack apps to the web server.
  config.mounts = { &quot;/my&quot; =&gt; MyApp }
  
  # auth: user:password string
  # Set basic authentication for the server and client.
  config.auth = &quot;admin:secret&quot;

end
</code></pre>
<h1><a class="header" href="#worker-configuration" id="worker-configuration">Worker Configuration</a></h1>
<p>The worker options can be configured by command line options or by specifying
a worker configuration file when running it.</p>
<p>The configuration file can be used to:</p>
<ul>
<li>Specify default values for the worker (instead of specifying them inside
the jobs themselves).</li>
<li>Specify additional advanced sidekiq configuration options.</li>
</ul>
<blockquote>
<p><i class='fa fa-info-circle'></i> <strong>Tip</strong>:
The worker configuration file is in fact a
<a href="https://github.com/mperham/sidekiq/wiki/Advanced-Options">sidekiq configuration file</a>.
Refer to the sidekiq documentation if you need more advanced options.</p>
</blockquote>
<h2><a class="header" href="#sample-worker-configuration-file" id="sample-worker-configuration-file">Sample Worker Configuration File</a></h2>
<pre><code class="language-yaml"># config/my-worker.yml
---
:concurrency: 2
:queues:
- critical
- default
- mundane
</code></pre>
<p>Place your YAML config file inside the config folder, and use the
<code>jobly worker --config my-worker</code> to use it.</p>
<blockquote>
<p><i class='fa fa-exclamation-triangle'></i> <strong>Note</strong>: The filename specified
with the <code>--config</code> flag must be placed inside the config folder.
You do not need to specify the folder name or the <code>.yml</code> extension.</p>
</blockquote>
<blockquote>
<p><i class='fa fa-arrow-right'></i> <strong>See Also</strong>:
<a href="configuration//examples/worker-config-example.html">Worker Config Example</a></p>
</blockquote>
<h1><a class="header" href="#examples" id="examples">Examples</a></h1>
<p>The examples in this section are
<a href="https://github.com/DannyBen/jobly-examples">also available on GitHub</a>.</p>
<p>Each example demonstrates a specific feature or aspect of Jobly.</p>
<h1><a class="header" href="#basic-example" id="basic-example">Basic Example</a></h1>
<h2><a class="header" href="#code" id="code">Code</a></h2>
<pre><code class="language-ruby"># jobs/hello.rb
class Hello &lt; Jobly::Job
  def execute(name: 'bob')
    puts &quot;Hello #{name}&quot;
    logger.info &quot;said hello to #{name}&quot;
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try" id="commands-to-try">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/basic

# Run the job locally and immediately
jobly run Hello

# Start the worker
jobly worker

# From another terminal, send the job to the worker
jobly run --later Hello name:Jimmy

# Start the API / Dashboard server then visit http://localhost:3000
jobly server

# From another terminal, send the job from the command line to the API
jobly send Hello

# Schedule a job by accessing the API:
open http://localhost:3000/do/Hello?name=Guest
</code></pre>
<h1><a class="header" href="#job-callbacks-example" id="job-callbacks-example">Job Callbacks Example</a></h1>
<p>This example illustrates the use of <code>before</code>, <code>after</code>, <code>on_skip</code>,
<code>on_success</code>, and <code>on_failure</code> blocks.</p>
<h2><a class="header" href="#code-1" id="code-1">Code</a></h2>
<pre><code class="language-ruby"># jobs/actions.rb
class Actions &lt; Jobly::Job
  before { puts &quot;before&quot; }
  after  { puts &quot;after&quot; }

  on_success { puts &quot;on_success&quot; }
  on_failure { puts &quot;on_failure&quot; }

  after :after_party

  def execute(fail: false)
    puts &quot;execute 1/2&quot;
    raise &quot;RAISED&quot; if fail
    puts &quot;execute 2/2&quot;
  end

  def after_party
    puts &quot;after_party&quot;
  end
end
</code></pre>
<pre><code class="language-ruby"># jobs/filter.rb
class Filter &lt; Jobly::Job
  before do
    puts &quot;before&quot;
    skip_job
  end

  after do
    puts &quot;after&quot;
  end

  on_skip    { puts &quot;on_skip&quot; }
  on_success { puts &quot;on_success&quot; }
  on_failure { puts &quot;on_failure&quot; }

  def execute
    puts &quot;execute&quot;
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try-1" id="commands-to-try-1">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/before-after-actions

# Run the job in its successful form
jobly run Actions

# Run the job in its failed form
jobly run Actions fail:yes

# Run the filter job (will not execute the job body)
jobly run Filter
</code></pre>
<h1><a class="header" href="#docker-compose-example" id="docker-compose-example">Docker Compose Example</a></h1>
<p>This example demonstrates how to use Jobly inside a docker container and with
docker compose.</p>
<h2><a class="header" href="#code-2" id="code-2">Code</a></h2>
<pre><code class="language-dockerfile"># Dockerfile
FROM dannyben/alpine-ruby
RUN gem install jobly
WORKDIR /app
COPY app .
</code></pre>
<pre><code class="language-yaml"># docker-compose.yml
version: '3'

services:
  redis:
    image: redis

  bash: &amp;default
    build: .
    image: temp/jobly
    depends_on: [redis]
    volumes:
    - ./app:/app
    environment:
      JOBLY_REDIS_URL: redis://redis:6379/0
      JOBLY_API_URL: http://web:3000/do

  web:
    &lt;&lt;: *default
    ports: [&quot;3000:3000&quot;]
    command: jobly server

  worker:
    &lt;&lt;: *default
    command: jobly worker

  send:
    &lt;&lt;: *default
    depends_on: [web]
    entrypoint: jobly send
    command: Hello
</code></pre>
<pre><code class="language-ruby"># app/jobs/hello.rb
class Hello &lt; Jobly::Job
  def execute(name: 'bob')
    puts &quot;Hello #{name}&quot;
    logger.info &quot;said hello to #{name}&quot;
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try-2" id="commands-to-try-2">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/docker-compose

# Build the images
docker-compose build

# Start the server and the worker
docker-compose up web worker

# Visit your server
open http://localhost:3000

# Send a test job
docker-compose run send

# ... or with parameters
docker-compose run send Hello name:Bobby
</code></pre>
<h1><a class="header" href="#job-in-job-example" id="job-in-job-example">Job in Job Example</a></h1>
<p>This example demonstrates how to call a job from inside another job.</p>
<p>Two approaches are possible:</p>
<ol>
<li>Executing secondary jobs synchronously, as part of the parent job.</li>
<li>Spawning the secondary jobs to be executed later by the worker, as
separate jobs.</li>
</ol>
<h2><a class="header" href="#code-3" id="code-3">Code</a></h2>
<pre><code class="language-ruby"># jobs/run_sync.rb

# This job will call the other jobs synchronously and display progress
# in the dashboard

class RunSync &lt; Jobly::Job
  def execute(count: 10)
    total count

    count.times do |i|
      at i
      puts &quot;Executing Job ##{i}&quot;
      SubJob.execute number: i
    end

    at count, &quot;Done&quot;
  end
end
</code></pre>
<pre><code class="language-ruby"># jobs/run_async.rb

# This job will spawn child threads for the sub jobs.
# Each of the spawned jobs will have its own progress bar in the dashboard.

class RunAsync &lt; Jobly::Job
  def execute(count: 10)
    count.times do |i|
      SubJob.execute_async number: i
    end
  end
end
</code></pre>
<pre><code class="language-ruby"># jobs/sub_job.rb
class SubJob &lt; Jobly::Job
  def execute(number:)
    logger.info &quot;Executing... something... #{number}&quot;
    sleep rand(1..5)
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try-3" id="commands-to-try-3">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/job-in-job

# Start the server and worker
foreman start

# From another terminal, send the jobs to the worker
jobly send RunSync count:20
jobly send RunAsync count:10
</code></pre>
<h1><a class="header" href="#namespaces-example" id="namespaces-example">Namespaces Example</a></h1>
<p>This example illustrates how to define jobs that are namespaced in modules.</p>
<p>It illustrates:</p>
<ol>
<li>How all jobs can be nested inside a specific module that is used as the
default namespace for all jobs - see the config folder.</li>
<li>How additional namespacing is done by putting some jobs under a nested
module and (optionally, by convention) putting them inside a subfolder -
see the jobs folder.</li>
</ol>
<h2><a class="header" href="#code-4" id="code-4">Code</a></h2>
<pre><code class="language-ruby"># config/jobly.rb
Jobly.configure do |config|
  config.jobs_namespace = 'Jobs'
end
</code></pre>
<pre><code class="language-ruby"># jobs/hello.rb

# Global namespace for all jobs
module Jobs
  class Hello &lt; Jobly::Job
    def execute(name: 'bob')
      puts &quot;Hello #{name}&quot;
      logger.info &quot;said hello to #{name}&quot;
    end
  end
end
</code></pre>
<pre><code class="language-ruby"># jobs/inner/hi.rb
module Jobs
  # A nested job, can be executed with Inner::Hi or Inner/Hi
  module Inner
    class Hi &lt; Jobly::Job
      def execute(name: 'bob')
        puts &quot;Hi #{name}, this is #{self.class.name}&quot;
        logger.info &quot;said hello to #{name} from #{self.class.name}&quot;
      end
    end
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try-4" id="commands-to-try-4">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/namespaces

# Run the namespaced job that is found in the root namespace `Jobs`
jobly run Hello

# Run the nested job that is found in the root namespace `Jobs::Inner`
jobly run Inner::Hi
</code></pre>
<h1><a class="header" href="#options-and-errors-example" id="options-and-errors-example">Options and Errors Example</a></h1>
<p>This example illustrates setting the job options: <code>backtrace</code>, <code>queue</code> and
<code>retries</code>.</p>
<h2><a class="header" href="#code-5" id="code-5">Code</a></h2>
<pre><code class="language-ruby"># jobs/deploy.rb
class Deploy &lt; Jobly::Job
  # This job runs on the 'critical' queue
  queue 'critical'

  # On failure, show 5 backtrace lines in the web UI
  backtrace 5

  # On failure, retry once only
  retries 1

  def execute(env: 'stage')
    puts &quot;Deploying to #{env}&quot;
    raise &quot;Something went wrong...&quot;
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try-5" id="commands-to-try-5">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/options-and-errors

# Start the server and the worker
foreman start

# Or one by one
jobly server
jobly worker --queue critical

# From another terminal, send the job to the worker
jobly send Deploy

# View the failed job and its backtrace in the Retries tab
open http://localhost:3000/retries
</code></pre>
<h1><a class="header" href="#slack-notifications-example" id="slack-notifications-example">Slack Notifications Example</a></h1>
<p>This example illustrates how to send slack notifications from your jobs.
Note that for this to work, you need to
<a href="https://slack.com/apps/A0F7XDUAZ-incoming-webhooks">set up a web hook in your Slack configuration</a>
and then make it available to Jobly by the <code>slack_webhook</code> option or the
<code>JOBLY_SLACK_WEBHOOK</code> environment variable.</p>
<h2><a class="header" href="#code-6" id="code-6">Code</a></h2>
<pre><code class="language-ruby"># jobs/greet.rb
class Greet &lt; Jobly::Job
  # Optional settings (defaults to #general and Jobly)
  slack_channel '#debug'
  slack_user 'Greeter'

  def execute(name: 'bob')
    # Quick message
    slack.ping &quot;Hello #{name}&quot;

    # Message with attachment
    slack.post attachments: { text: &quot;Good text&quot;, color: &quot;good&quot; }
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try-6" id="commands-to-try-6">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/slack-notifications

# Set your slack webhook in an environment variable
export JOBLY_SLACK_WEBHOOK=https://hooks.slack.com/services/...

# Run the job
jobly run Greet
</code></pre>
<h1><a class="header" href="#syslog-example" id="syslog-example">Syslog Example</a></h1>
<p>This example illustrates how to configure Jobly to send all logger events to
a local or remote syslog.</p>
<h3><a class="header" href="#enabling-syslog-udp-connection" id="enabling-syslog-udp-connection">Enabling syslog UDP connection</a></h3>
<p>Note that for this to work, your syslog must be configured to accept UDP
connections.</p>
<p>Edit <code>/etc/rsyslog.conf</code> and uncomment these lines:</p>
<pre><code class="language-php"># provides UDP syslog reception
module(load=&quot;imudp&quot;)
input(type=&quot;imudp&quot; port=&quot;514&quot;)
</code></pre>
<h2><a class="header" href="#code-7" id="code-7">Code</a></h2>
<pre><code class="language-ruby"># config/jobly.rb
Jobly.configure do |config|
  # Log to local syslog and use the system name `jobly` and tag `demo`
  config.log = &quot;syslog://jobly:demo@127.0.0.1:514&quot;
  config.logger.level = Logger::INFO
end
</code></pre>
<pre><code class="language-ruby"># jobs/hello.rb
class Hello &lt; Jobly::Job
  def execute(name: 'bob')
    puts &quot;Hello #{name}&quot;
    logger.info &quot;said hello to #{name}&quot;
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try-7" id="commands-to-try-7">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/syslog

# Install additional gem dependencies
bundle install

# Start watching the syslog
sudo tail -f /var/log/syslog

# Start both the server and the worker
foreman start

# Send jobs from the command line to the API
jobly send Hello
</code></pre>
<h1><a class="header" href="#worker-config-example" id="worker-config-example">Worker Config Example</a></h1>
<p>This example makes use of worker configuration file in order to tell the
worker to process two queues (<code>critical</code> and <code>mundane</code>) instead of the
<code>default</code> queue.</p>
<p>Note that the same can also be achieved through the command line, without
using a config file.</p>
<h2><a class="header" href="#code-8" id="code-8">Code</a></h2>
<pre><code class="language-yaml"># config/worker.yml
:concurrency: 2
:queues:
- critical
- default
- mundane
</code></pre>
<pre><code class="language-ruby"># jobs/critical.rb
class Critical &lt; Jobly::Job
  options queue: 'critical'

  def execute
    logger.info &quot;Running a critical job&quot;
  end
end
</code></pre>
<pre><code class="language-ruby"># jobs/mundane.rb
class Mundane &lt; Jobly::Job
  options queue: 'mundane'

  def execute
    logger.info &quot;Running a mundane job&quot;
  end
end
</code></pre>
<pre><code class="language-text"># Procfile
web: jobly server
worker: jobly worker --config worker
</code></pre>
<h2><a class="header" href="#commands-to-try-8" id="commands-to-try-8">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/worker-config

# Start the server and worker
# Note that the `Procfile` is defined to run `jobly worker --config worker`
# which points the worker to the `config/worker.yml` configuration file
foreman start

# From another terminal, send the jobs to the worker
jobly send Critical
jobly send Mundane
</code></pre>
<h1><a class="header" href="#solo-job-example" id="solo-job-example">Solo Job Example</a></h1>
<p>This example demonstrates how to ensure only one instance of the job is
executed at any given time.</p>
<h2><a class="header" href="#code-9" id="code-9">Code</a></h2>
<pre><code class="language-ruby"># jobs/solo.rb
class Solo &lt; Jobly::Job
  solo

  on_skip do
    at 70, &quot;Skipped&quot;
    logger.info &quot;Job was skipped&quot;
  end

  def execute(name: 'bob')
    total 100
    at 10, &quot;Initializing&quot;
    sleep 20
    at 100, &quot;Done&quot;
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try-9" id="commands-to-try-9">Commands to Try</a></h2>
<p>Before running these commands, it is recommended you open the Statuses tab
in the web dashboard.</p>
<pre><code class="language-bash">cd examples/solo

# Start the server and worker
foreman start

# From another terminal, send the Solo job twice
jobly send Solo
jobly send Solo

# Finally, while the job is still locked, send it again with different 
# parameters (and therefore, a different fingerprint).
jobly send Solo name:Bart
</code></pre>
<h1><a class="header" href="#settings-example" id="settings-example">Settings Example</a></h1>
<p>This example illustrates how to use the <code>settings</code> helper to load custom 
settings into your jobs.</p>
<h2><a class="header" href="#code-10" id="code-10">Code</a></h2>
<pre><code class="language-ruby"># jobs/show_settings.rb
class ShowSettings &lt; Jobly::Job
  def execute
    puts &quot;Loading settings for #{Jobly.environment}&quot;

    # Show all settings hash
    pp settings.settings

    # Access a value
    puts settings.host

    # Access a deeper value or an array value
    puts settings.apps[0]
    puts settings.login['user']
  end
end
</code></pre>
<pre><code class="language-yaml"># config/settings.yml
host: example.com
port: 80

apps:
- /apps/todo-list
- /apps/greeter

login:
  user: admin
  password: &lt;%= ENV['MY_SECRET'] =&gt;
</code></pre>
<pre><code class="language-yaml"># config/settings.development.yml
host: localhost
port: 3000
</code></pre>
<h2><a class="header" href="#commands-to-try-10" id="commands-to-try-10">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/settings

# Run the job
jobly run ShowSettings
</code></pre>
<h1><a class="header" href="#data-store-example" id="data-store-example">Data Store Example</a></h1>
<p>This example demonstrates how to store and retrieve arbitrary data on redis.</p>
<h2><a class="header" href="#code-11" id="code-11">Code</a></h2>
<pre><code class="language-ruby"># jobs/build.rb
class Build &lt; Jobly::Job
  def execute
    # Get &quot;build_number&quot; from redis, or default to 0
    build_number = retrieve(:build_number).to_i || 0

    # Increase build number and store it back on redis
    build_number += 1
    store build_number: build_number.to_s

    # Use the value
    puts &quot;Building #{build_number}&quot;
    logger.info &quot;Built #{build_number}&quot;
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try-11" id="commands-to-try-11">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/storing-data-in-redis

# Run the command several times to get a new build number
jobly run Build
jobly run Build
</code></pre>
<h1><a class="header" href="#custom-rack-mount-example" id="custom-rack-mount-example">Custom Rack Mount Example</a></h1>
<p>This example demonstrates how to ammend the web server so that it also serves
any custom rack app.</p>
<h2><a class="header" href="#code-12" id="code-12">Code</a></h2>
<pre><code class="language-ruby"># config/jobly.rb
require_relative '../app/my_server'

Jobly.configure do |config|
  config.mounts = { &quot;/my&quot; =&gt; MyServer }
end
</code></pre>
<pre><code class="language-ruby"># app/my_server.rb
require &quot;sinatra/base&quot;

class MyServer &lt; Sinatra::Base
  get '/' do
    &quot;Hello from MyServer!&quot;
  end
end
</code></pre>
<h2><a class="header" href="#commands-to-try-12" id="commands-to-try-12">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/custom-rack-mount

# Start the server
jobly server

# Call your custom app
curl http://localhost:3000/my
</code></pre>
<h1><a class="header" href="#basic-auth-example" id="basic-auth-example">Basic Auth Example</a></h1>
<h2><a class="header" href="#commands-to-try-13" id="commands-to-try-13">Commands to Try</a></h2>
<pre><code class="language-bash">cd examples/basic

# Start the server with basic auth enabled
JOBLY_AUTH=user:pass jobly server

# Send a job without authentication
# This operation will fail
jobly send Hello

# Send an authenticated job request
# This operation will succeed
JOBLY_AUTH=user:pass jobly send Hello
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        
        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://0.0.0.0:3001");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload(true); // force reload from server (not from cache)
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        

        
        <!-- Google Analytics Tag -->
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-6696444-13', 'auto');
                ga('send', 'pageview');
            }
        </script>
        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
:@base_urio:URI::HTTP:@schemeI"	http:ET:
@user0:@password0:
@hostI"localhost;
T:
@porti:
@pathI"/print.html;
T:@query0:@opaque0:@fragment0:@parsero:URI::RFC3986_Parser:@regexp{:SCHEMEI/!\A[A-Za-z][A-Za-z0-9+\-.]*\z ;
F:USERINFOI/'\A(?:%\h\h|[!$&-.0-;=A-Z_a-z~])*\z ;
F:	HOSTI/h\A(?:(?<IP-literal>\[(?:(?<IPv6address>(?:\h{1,4}:){6}(?<ls32>\h{1,4}:\h{1,4}|(?<IPv4address>(?<dec-octet>[1-9]\d|1\d{2}|2[0-4]\d|25[0-5]|\d)\.\g<dec-octet>\.\g<dec-octet>\.\g<dec-octet>))|::(?:\h{1,4}:){5}\g<ls32>|\h{,4}::(?:\h{1,4}:){4}\g<ls32>|(?:(?:\h{1,4}:)?\h{1,4})?::(?:\h{1,4}:){3}\g<ls32>|(?:(?:\h{1,4}:){,2}\h{1,4})?::(?:\h{1,4}:){2}\g<ls32>|(?:(?:\h{1,4}:){,3}\h{1,4})?::\h{1,4}:\g<ls32>|(?:(?:\h{1,4}:){,4}\h{1,4})?::\g<ls32>|(?:(?:\h{1,4}:){,5}\h{1,4})?::\h{1,4}|(?:(?:\h{1,4}:){,6}\h{1,4})?::)|(?<IPvFuture>v\h+\.[!$&-.0-;=A-Z_a-z~]+))\])|\g<IPv4address>|(?<reg-name>(?:%\h\h|[!$&-.0-9;=A-Z_a-z~])*))\z ;
F:ABS_PATHI/L\A/(?:%\h\h|[!$&-.0-;=@-Z_a-z~])*(?:/(?:%\h\h|[!$&-.0-;=@-Z_a-z~])*)*\z ;
F:REL_PATHI/K\A(?:%\h\h|[!$&-.0-;=@-Z_a-z~])+(?:/(?:%\h\h|[!$&-.0-;=@-Z_a-z~])*)*\z ;
F:
QUERYI/)\A(?:%\h\h|[!$&-.0-;=@-Z_a-z~/?])*\z ;
F:FRAGMENTI/)\A(?:%\h\h|[!$&-.0-;=@-Z_a-z~/?])*\z ;
F:OPAQUEI/\A(?:[^/].*)?\z ;
F:	PORTI/4\A[\x09\x0a\x0c\x0d ]*\d*[\x09\x0a\x0c\x0d ]*\z ;
F:@error0